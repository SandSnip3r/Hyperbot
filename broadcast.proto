syntax = "proto3";

import "google/protobuf/empty.proto";

package broadcast;

// Enums

enum ItemLocation {
  kCharacterInventory = 0;
  kAvatarInventory = 1;
  kCosInventory = 2;
  kStorage = 3;
  kGuildStorage = 4;
}

enum EntityType {
  kSelf = 0;
  kCharacter = 1;
  kPlayerCharacter = 2;
  kNonplayerCharacter = 3;
  kMonster = 4;
  kItem = 5;
  kPortal = 6;
};

// Sub-structures

message Position {
  uint32 regionId = 1;
  float x = 2;
  float y = 3;
  float z = 4;
}

// Messages

message CharacterHpUpdate {
  uint32 currentHp = 1;
}

message CharacterMpUpdate {
  uint32 currentMp = 1;
}

message CharacterMaxHpMpUpdate {
  uint32 maxHp = 1;
  uint32 maxMp = 2;
}

message CharacterLevelUpdate {
  int32 level = 1;
  int64 expRequired = 2;
}

message CharacterExperienceUpdate {
  uint64 currentExperience = 1;
  uint32 currentSpExperience = 2;
}

message CharacterSpUpdate {
  uint32 skillPoints = 1;
}

message CharacterNameUpdate {
  string name = 1;
}

message GoldAmountUpdate {
  uint64 goldAmount = 1;
  ItemLocation goldLocation = 2;
}

message RegionNameUpdate {
  string name = 1;
}

message CharacterMovementBegan {
  Position currentPosition = 1;
  oneof destination {
    Position destinationPosition = 2;
    uint32 destinationAngle = 3;
  }
  float speed = 4;
}

message CharacterMovementEnded {
  Position currentPosition = 1;
}

message ItemUpdate {
  ItemLocation itemLocation = 1;
  uint32 slotIndex = 2;
  uint32 quantity = 3;
  optional string itemName = 4;
}

message EntitySpawned {
  uint32 globalId = 1;
  Position position = 2;
  EntityType entityType = 3;
}

message EntityDespawned {
  uint32 globalId = 1;
}

// Broadcast message

message BroadcastMessage {
  oneof body {
    google.protobuf.Empty characterSpawn = 1;
    CharacterHpUpdate characterHpUpdate = 2;
    CharacterMpUpdate characterMpUpdate = 3;
    CharacterMaxHpMpUpdate characterMaxHpMpUpdate = 4;
    CharacterLevelUpdate characterLevelUpdate = 5;
    CharacterExperienceUpdate characterExperienceUpdate = 6;
    CharacterSpUpdate characterSpUpdate = 7;
    CharacterNameUpdate characterNameUpdate = 8;
    GoldAmountUpdate goldAmountUpdate = 9;
    CharacterMovementBegan characterMovementBegan = 10;
    CharacterMovementEnded characterMovementEnded = 11;
    RegionNameUpdate regionNameUpdate = 12;
    ItemUpdate itemUpdate = 13;
    EntitySpawned entitySpawned = 14;
    EntityDespawned entityDespawned = 15;
  }
}
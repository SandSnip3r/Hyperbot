# TODO

- Delete "old_config" from protobuf definition & UI
- Address ASAN-detected memory leaks
  - `sro::navmesh::triangulation::NavmeshTriangulation::buildNavmeshForRegion`
- eventBroker.cpp:130 handle memory leak when destructed, events lost in handle function
- Get away from include & src directories in silkroad_lib
- It would be really nice to have a local list of known characters
- Add UI element to toggle packet logging to console
- Auto relogin when a character disconnects
- Ensure that no state machine does any work in its constructor
  - Bonus if we can guarantee it
- Remove StateMachineActiveTooLong event
- Remove StateMachineCreated/Destroyed in ctors/dtors
- Make StateMachine::name a virtual function
- Handle the case when state::machine::PickItem's target item is picked by someone else
- If `SequentialStateMachines` is here to stay, rename it as something like `StateMachineQueue`, to represent that once a contained state machine is complete, it is destroyed and removed from the queue
- Change silkroad_lib dir to sro and match the project, so that the include path looks the same as the namespace
- Create a "pvp ledger" which holds all PvpDescriptors. Rather than sending around copies of PvpDescriptors, we can instead share pointers into the ledger
- Additionally, add move constructors for state machines which take in vectors of items, like Walking or GmCommandSpawnAndPickItems
- In the construction of state machines, with its reference to Bot, register itself with the bot. This would make it so that I dont need to manually also write code in the Bot to hold & execute the state machine
- In the construction of state machines, also give a pointer to the parent state machine
  - With this, and a private overridden version of onUpdate, we can catch & rethrow exceptions giving a "stack trace" of which state machine we were in
- Consolidate `type_id::TypeId storage::Item::typeId()` and `TypeId type_id::getTypeId(const sro::pk2::ref::Item &item)`
- Reimplement some version of pathfinding in case a character disconnects while dead and ends up back in town
- Send pings so that if the client crashes, the character does not disconnect
- Stop passing around GameData and make it a global singleton. It is a constant set of data that lots of parts of the code need to access. There's no point in passing it around everywhere
- In the state machine which enables PVP, if it gets cancelled, start again
- I think for command/skill tracking, a couple changes should be made.
  - If a "command" is "queued", the packet does not tell us which command has actually been queued. Right now, we assume that it was the first in the queue, which would be the first one requested. In practice, based on which skill executes next, I'm seeing that it can actually be the most recently requested. To solve for this, I think we should actually move the entire pending queue contents over to the accepted queue. This kind of leaves a new problem though. We might move something which the server did not actually officially accept. This is handled in the next point.
  - Currently, when we see a skill begin, we look through our accepted command queue starting from the back (last "accepted" first). Once (and if) we find a matching skill, we remove everything in the queue before it (newer accepted commands). I think we should instead look in the opposite order. We should find the most recent queuing of that skill. Still, we would remove everything before it. This will result in fewer things being removed. This also solves for mistakes that result because of the above change. We'll probably be moving too many things into the accepted queue because of that change. However, here, we're trimming everything which we added excessively.
- Try to create repro for pybind11 module/interpreter issue where the interpreter is a class member